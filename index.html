<!doctype html>
<html>
  <head>
    <title>bars</title>
    <link rel="stylesheet" href="pen.css">
    <link rel="shortcut icon" href="favicon.ico">
  </head>
  <body>
    <div id="container" class="container"></div>
    <script src="pen.js"></script>
    <script>
      var el = document.querySelector("#container"),
          get = queueueue(50),
          chart,
          config,
          wsURL;

      wsURL = location.search.replace(/^.*?\=/, '');

      if (wsURL.length === 0) {
        wsURL = "localhost:9999";
      }

      socket_ = new WebSocket("ws://" + decodeURIComponent(wsURL));
      socket_.onmessage = function (msg) {
        try {
          var data = JSON.parse(msg.data);
          if (!config) {
            config = data;
            return setup();
          }
          chart.plot(get(parseInt(data, 10)));
        } catch(e) { }
      };

      function setup() {
        chart = graph(
          el,
          config.min || 0,
          config.max || 100
        );
      }

      function queueueue(length) {
        // generate an array of 0s of the desired length.
        var _values = (Array(length) + "").split(",").map(Number);

        return function(newVal) {
          _values = _values.slice(1).concat([newVal]);
          return _values;
        };
      };
    </script>
  </body>
</html>
